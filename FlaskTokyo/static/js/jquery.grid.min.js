(function (e) { e.fn.tGrid = function (o) { t = e(this); n = e(window); i = e.extend({}, e.fn.tGrid.defaults, o); a(); u(); n.unbind("resize").resize(function () { var e; var o = n.width() - i.offsetX * 2; if (o < s * r) { a(); e = s * (r - 1) } else if (o > s * (r + 1)) { a(); e = s * (r + 1) } if (e) { var f = t.width(); t.width(s * r); u() } }); return this }; e.fn.tGrid.defaults = { offsetX: 5, offsetY: 5, gridElement: "div" }; var t, n, r, i = {}, s, o = []; if (!Array.prototype.indexOf) { Array.prototype.indexOf = function (e) { var t = this.length >>> 0; var n = Number(arguments[1]) || 0; n = n < 0 ? Math.ceil(n) : Math.floor(n); if (n < 0) { n += t } for (; n < t; n++) { if (n in this && this[n] === e) { return n } } return -1 } } var u = function () { f(); t.children(i.gridElement).each(function (t) { v(e(this)) }); var n = p(0, o.length); t.height(n.max + i.offsetY) }; var a = function () { s = e(i.gridElement).outerWidth() + i.offsetX * 2; r = Math.floor((n.width() - i.offsetX * 2) / s) }; var f = function () { o = []; for (var e = 0; e < r; e++) { l(e, 0, 1, -i.offsetY) } }; var l = function (e, t, n, r) { for (var s = 0; s < n; s++) { var u = []; u.x = e + s; u.size = n; u.endY = t + r + i.offsetY * 2; o.push(u) } }; var c = function (e, t) { for (var n = 0; n < t; n++) { var r = h(e + n); o.splice(r, 1) } }; var h = function (e) { for (var t = 0; t < o.length; t++) { var n = o[t]; if (n.x == e) { return t } } }; var p = function (e, t) { var n = []; var r = []; for (var i = 0; i < t; i++) { var s = h(e + i); r.push(o[s].endY) } n.min = Math.min.apply(Math, r); n.max = Math.max.apply(Math, r); n.x = r.indexOf(n.min); return n }; var d = function () { var e = []; var t = p(0, o.length); e.x = t.x; e.y = t.min; return e }; var v = function (e) { if (!e.data("size") || e.data("size") < 0) { e.data("size", 1) } var t = d(); var n = s * e.data("size") - (e.outerWidth() - e.width()); e.css({ left: t.x * s, top: t.y, position: "absolute" }); var r = e.outerHeight(); c(t.x, e.data("size")); l(t.x, t.y, e.data("size"), r) } })(jQuery)